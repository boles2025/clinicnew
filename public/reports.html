<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التقارير - عيادة التغذية</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Tajawal', sans-serif; background-color: #f0f2f5; padding-top: 80px; }
        .filter-bar { background: white; padding: 1rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.07); }
        .report-card { border-radius: 15px; padding: 2rem 1.5rem; color: white; text-align: center; box-shadow: 0 8px 25px -10px rgba(0,0,0,0.3); transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer; display: flex; flex-direction: column; justify-content: center; min-height: 180px; }
        .report-card:hover { transform: translateY(-8px); box-shadow: 0 12px 35px -10px rgba(0,0,0,0.4); }
        .report-card .card-icon { font-size: 2.5rem; margin-bottom: 0.5rem; opacity: 0.8; }
        .report-card .card-value { font-size: 2.2rem; font-weight: 700; }
        .report-card .card-title { font-size: 1rem; font-weight: 500; }
        .card-revenues { background: linear-gradient(135deg, #1d976c, #93f9b9); }
        .card-checkups { background: linear-gradient(135deg, #ff4e50, #f9d423); }
        .card-followups { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .card-patients { background: linear-gradient(135deg, #4e54c8, #8f94fb); }
        #detailsModal .modal-content { border-radius: 15px; }
    </style>
</head>
<body class="reports-page">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">عيادة التغذية</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link active" href="index.html"><i class="fas fa-home"></i> الرئيسية</a></li>
                    <li class="nav-item"><a class="nav-link" href="patients_register.html"><i class="fas fa-user-plus"></i> تسجيل مريض</a></li>
                    <li class="nav-item"><a class="nav-link" href="visits.html"><i class="fas fa-calendar-check"></i> المتابعات</a></li>
                    <li class="nav-item"><a class="nav-link" href="revenues.html"><i class="fas fa-money-bill-wave"></i> الإيرادات</a></li>
                    
                    <li class="nav-item"><a class="nav-link" href="calendar.html"><i class="fas fa-calendar-alt"></i> بحث بالتاريخ</a></li>
                    <li class="nav-item"><a class="nav-link" href="backup.html"><i class="fas fa-database"></i> النسخ الاحتياطي</a></li>
                    <li class="nav-item"><a class="nav-link" href="delete.html"><i class="fas fa-trash-alt"></i> الحذف</a></li>
                </ul>
                
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Filter Bar -->
        <div class="filter-bar mb-4 animate__animated animate__fadeInDown">
            <div class="row g-3 align-items-center" id="filter-container">
                <div class="col-md-3"><label for="timePeriod" class="form-label fw-bold">فترة التقرير:</label><select id="timePeriod" class="form-select"><option value="this_month">هذا الشهر</option><option value="today">اليوم</option><option value="this_year">هذه السنة</option><option value="custom">فترة مخصصة</option></select></div>
                <div class="col-md-3 custom-date-fields d-none"><label for="startDate" class="form-label">من</label><input type="date" id="startDate" class="form-control"></div>
                <div class="col-md-3 custom-date-fields d-none"><label for="endDate" class="form-label">إلى</label><input type="date" id="endDate" class="form-control"></div>
                <div class="col-md-3 align-self-end"><button id="generateReportBtn" class="btn btn-primary w-100"><i class="fas fa-sync-alt"></i> تحديث</button></div>
            </div>
        </div>

        <!-- Report Cards -->
        <div class="row g-4" id="report-cards-container">
            <div class="col-12 text-center p-5" id="loading-state">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
                <p class="mt-2">جاري تحميل البيانات من Firebase...</p>
            </div>
        </div>
    </div>
    
    <!-- Details Modal -->
    <div class="modal fade" id="detailsModal" tabindex="-1"><div class="modal-dialog modal-xl modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="modalTitle"></h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="table-responsive"><table class="table table-striped table-hover" id="detailsTable"></table></div></div><div class="modal-footer"><button type="button" class="btn btn-success" id="export-excel-btn"><i class="fas fa-file-excel"></i> Excel</button><button type="button" class="btn btn-danger" id="export-pdf-btn"><i class="fas fa-file-pdf"></i> PDF</button><button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button></div></div></div></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="js/reports.js"></script>
</body>
</html>